<!DOCTYPE html>
<html lang="en">

<head>
    <title>合同管理-新增</title>
    <#include "../include/header.html">
    <style type="text/css">
        form { margin-top:20px;}
        label { padding-top:6px;padding-right:0;}
    </style>
</head>

<body style="width:85%;">
    <form id="defaultForm" class="form-horizontal" role="form" enctype="multipart/form-data" style="min-width: 680px">
        <#if record??>
        <input hidden="" name="id" value="${record.id}" id="id"> 
        <div style="display: inline-block">	
        <div class="form-group">
            <label class="col-xs-5 control-label text-right" for="customer">客户名称：</label>
            <div class="col-xs-6">
                <input class="form-control" id="customer" type="text" placeholder="客户名称"  name="customer" value="${record.customer!}"/>
            </div>
        </div>
        <div class="form-group">
            <label class="col-xs-5 control-label text-right" for="art_no">发货港：</label>
            <div class="col-xs-6">
                <input class="form-control" id="dispatch_port" type="text" placeholder="发货港"  name="dispatch_port" value="${record.dispatch_port!}"/>
            </div>
        </div>
        <div class="form-group">
            <label class="col-xs-5 control-label text-right" for="freight">运价：</label>
            <div class="col-xs-6">
                <input class="form-control" id="freight" type="text" placeholder="运价"  name="freight" value="${record.freight!}"/>
            </div>
        </div>
        </div>
        <div style="display: inline-block">
        <div class="form-group">
            <label class="col-xs-5 control-label text-right" for="recipient">货号：</label>
            <div class="col-xs-6">
                <input class="form-control" id="art_no" type="text" placeholder="货号"  name="art_no" value="${record.art_no!}"/>
            </div>
        </div>
        <div class="form-group">
            <label class="col-xs-5 control-label text-right" for="consignee">收货单位：</label>
            <div class="col-xs-6">
                <input class="form-control" id="consignee" type="text" placeholder="收货单位"  name="consignee" value="${record.consignee!}" style="padding-right: 2px"/>
            </div>
        </div>
        <div class="form-group">
            <label class="col-xs-5 control-label text-right" for="quantity">发货数量：</label>
            <div class="col-xs-6">
                <input class="form-control" id="quantity" type="text" placeholder="发货数量"  name="quantity" value="${record.quantity!}"/>
            </div>
        </div>
        </div>
        <div class="form-group">
            <label class="col-xs-2 control-label text-right" for="file" style="padding-top:0;width: 148.53px">附件：</label>
            <div class="col-xs-6">
            	<div hidden="" id="fileflag">
                	<input type="file" class="file" id="file" name="file" value="">
                </div>
                <#if record.attachment??>
                <div id="url"><p><span style="color:#009100;font-size:16px;width: 90%;float: left;">${record.attachment!}</span><a href="javascript:;" onclick="del(this)" style="width: 10%;float: left;"><i class="fa fa-times" title="删除"></i></a></br></p></div>
                </#if>
            </div>
        </div>
        <#else>
        <div style="display: inline-block">	
        <div class="form-group">
            <label class="col-xs-5 control-label text-right" for="customer">客户名称：</label>
            <div class="col-xs-6">
                <input class="form-control" id="customer" type="text" placeholder="客户名称"  name="customer"/>
            </div>
        </div>
        <div class="form-group">
            <label class="col-xs-5 control-label text-right" for="art_no">发货港：</label>
            <div class="col-xs-6">
                <input class="form-control" id="dispatch_port" type="text" placeholder="发货港"  name="dispatch_port"/>
            </div>
        </div>
        <div class="form-group">
            <label class="col-xs-5 control-label text-right" for="freight">运价：</label>
            <div class="col-xs-6">
                <input class="form-control" id="freight" type="text" placeholder="运价"  name="freight"/>
            </div>
        </div>
        </div>
        <div style="display: inline-block">
        <div class="form-group">
            <label class="col-xs-5 control-label text-right" for="recipient">货号：</label>
            <div class="col-xs-6">
                <input class="form-control" id="art_no" type="text" placeholder="货号"  name="art_no"/>
            </div>
        </div>
        <div class="form-group">
            <label class="col-xs-5 control-label text-right" for="consignee">收货单位：</label>
            <div class="col-xs-6">
                <input class="form-control" id="consignee" type="text" placeholder="收货单位"  name="consignee" style="padding-right: 2px"/>
            </div>
        </div>
        <div class="form-group">
            <label class="col-xs-5 control-label text-right" for="quantity">发货数量：</label>
            <div class="col-xs-6">
                <input class="form-control" id="quantity" type="text" placeholder="发货数量"  name="quantity"/>
            </div>
        </div>
        </div>
        <div class="form-group">
            <label class="col-xs-2 control-label text-right" for="file" style="padding-top:0;width: 148.53px">附件：</label>
            <div class="col-xs-6">
                <input type="file" class="file" id="file" name="file" value="">
                <div id="url"></div>
            </div>
        </div>
        </#if>
        <div class="form-group">
            <label class="col-xs-2 control-label" for="v5" style="width: 148.53px"></label>
            <div class="col-xs-6 ">
                <button type="submit" class="btn btn-11" id="save">　保存　</button>
            </div>
        </div>
    </form>
    
<script type="text/javascript">
function initFileInput(ctrlName){
    var control = $('#'+ctrlName);
    control.fileinput({
        language: 'zh', //设置语言
        showUpload: false, //是否显示上传按钮
        showRemove:true,
        dropZoneEnabled: false,
        showCaption: true,//是否显示标题
        showPreview :false,//是否显示预览
        enctype: 'multipart/form-data',
        uploadAsync: false, //同步上传
    })
}
initFileInput("file");

// 删除选中文件
function del(_obj){
	$(_obj).parent('p').remove();
	$("#fileflag").removeAttr("hidden");
	initFileInput("file");
}
// 回显文件
$(function () {
    var fileName = '${attachment!}'.split(",");
    if (fileName.length > 0) {
        for(var i in fileName){
            if(fileName[i] != ''){
                var file = fileName[i].substring(0, fileName[i].indexOf("@"));
                $('#url').append('<p><span _url="'+fileName[i]+'" style="width: 90%;float: left;">'+file+'</span><a _url="'+fileName[i]+'" href="javascript:;" onclick="del(this)" style="width: 10%;float: left;"><i class="fa fa-times" title="删除"></i></a></br></p>');
            }
        }
    } 
});

// 表单校验
$('#defaultForm').bootstrapValidator({
    message: 'This value is not valid',
    feedbackIcons: {
        valid: 'glyphicon glyphicon-ok',
        invalid: 'glyphicon glyphicon-remove',
        validating: 'glyphicon glyphicon-refresh'
    },
    fields: {
    	customer: {
        	validators: {
                notEmpty:{
                    message: '不能为空!'
                },
                regexp: {
                    regexp: /^[a-zA-Z0-9_\s\u0391-\uFFE5]+$/,
                    message: '不能包含特殊字符'
                }, 
                stringLength: {
                    min: 0,
                    max: 20,
                    message: '不能超过 20 个字符',
                }
            }
        },
        art_no: {
            validators: {
                notEmpty:{
                    message: '不能为空!'
                },
                regexp: {
                    regexp: /^[a-zA-Z0-9_\s\u0391-\uFFE5]+$/,
                    message: '不能包含特殊字符'
                }, 
                stringLength: {
                    min: 0,
                    max: 20,
                    message: '不能超过 20 个字符',
                }
            }
        },
        dispatch_port: {
            validators: {
                notEmpty:{
                    message: '不能为空!'
                },
                regexp: {
                    regexp: /^[a-zA-Z0-9_\s\u0391-\uFFE5]+$/,
                    message: '不能包含特殊字符'
                }, 
                stringLength: {
                    min: 0,
                    max: 20,
                    message: '不能超过 20 个字符',
                }
            }
        },
        consignee: {
            validators: {
                notEmpty:{
                    message: '不能为空!'
                },
                regexp: {
                    regexp: /^[a-zA-Z0-9_\s\u0391-\uFFE5]+$/,
                    message: '不能包含特殊字符'
                }, 
                stringLength: {
                    min: 0,
                    max: 20,
                    message: '不能超过 20 个字符',
                }
            }
        },
        freight: {
            validators: {
                notEmpty:{
                    message: '不能为空!'
                },
                regexp: {
                    regexp: /^[0-9]+(\.[0-9]{1,2})?$/,
                    message: '请输入正确的运价'
                }, 
                stringLength: {
                    min: 0,
                    max: 20,
                    message: '不能超过 20 个字符',
                }
            }
        },
        quantity: {
            validators: {
                notEmpty:{
                    message: '不能为空!'
                },
                regexp: {
                    regexp: /^[0-9]+(\.[0-9]{1,2})?$/,
                    message: '请输入正确的数量'
                }, 
                stringLength: {
                    min: 0,
                    max: 20,
                    message: '不能超过 20 个字符',
                }
            }
        },
        file:{
            validators:{
                notEmpty:{
                    message:'请选择附件'
                }
            }
        }
    },
})
.on('success.form.bv', function(e) {
    e.preventDefault();
    var formData = new FormData();
	formData.append("file",$("#file")[0].files[0]);
    if($("#id").val()!=null&&$("#id").val()!=""){
    	formData.append("id",$("#id").val());
    }
    formData.append("customer",$("#customer").val());
    formData.append("art_no",$("#art_no").val());
    formData.append("dispatch_port",$("#dispatch_port").val());
    formData.append("consignee",$("#consignee").val());
    formData.append("freight",$("#freight").val());
    formData.append("quantity",$("#quantity").val());
    $.ajax({
        url:"/insidejob/contract/saveContract",
        type:"POST",
        data:formData,
        processData:false,
        contentType:false,
        success:function(result){
            if(result){
                layer.msg('保存成功', {time: 2000}, function(){
                    parent.parent.refresh_iframe();
                });
            }else{
                layer_close();
            }
        },
        error:function(e){
            console.log("error");
        },
    });

});

</script>

</body>

</html>
